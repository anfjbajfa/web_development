import{P as le,Q as oe,M as te,S as U,T as se,h as v,r,o as g,c as b,d as o,n as ne,b as l,N as f,f as s,l as N,w as O,U as D,t as i,u as K,e as t,F as ae,K as re,E as I,V as ie,W as ue,_ as de}from"./index-d9bb89e8.js";const ve={class:"profile_container"},pe={class:"profile_sidebar"},fe={class:"menu"},ce={class:"profile-main-content"},me={id:"userInfo",class:"box-container"},_e={style:{"margin-top":"20px"}},we={class:"profile-info"},ge={class:"profile_user_detail"},be={style:{"font-style":"italic"}},ye={style:{"font-style":"italic"}},ke={style:{"font-style":"italic"}},Ce={class:"change_info"},Ve={slot:"footer",class:"dialog-footer"},xe={id:"orderDetails",class:"box-container"},Pe={style:{"margin-top":"20px"}},Ie={key:0},he={key:1},Ne={key:0,id:"database",class:"box-container"},Oe={style:{"margin-top":"20px"}},De={key:1,id:"orderProcess",class:"box-container"},Fe={style:{"margin-top":"20px"}},$e=le({__name:"Profile",setup(Se){const V=oe();te(()=>{V.dispatch("checkLoginStatus")});const x=U(()=>V.getters.isAdmin),y=se(),P=v(!1),c=v(!1),p=v(!1),k=v(!1),C=v(!1),q=U(()=>V.getters.hasNewOrder),L=U(()=>V.getters.pendingOrderCount),h=a=>{const e=document.getElementById(a);if(V.commit("setHasNewOrder",!1),e)switch(e.scrollIntoView({behavior:"smooth"}),a){case"userInfo":G();break;case"orderDetails":T();break;case"database":B();break;case"orderProcess":E();break}},u=v({newPassword:"",verificationCode:""}),Q={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位",trigger:"blur"}]},A=v(),m=v(0);let _=null;const R=async()=>{try{console.log(y.phone),await re(y.phone),I.success("验证码已发送"),m.value=60,_=window.setInterval(()=>{m.value>0?m.value--:_&&(clearInterval(_),_=null)},1e3)}catch{I.error("发送验证码失败，请重试")}},W=()=>{var a;(a=A.value)==null||a.validate(async e=>{if(e)try{await ie(y.phone,u.value.newPassword,u.value.verificationCode),I.success("密码修改成功"),P.value=!1,M()}catch{I.error("密码修改失败，请检查验证码或重试")}else return I.error("请填写完整信息"),!1})},G=()=>{p.value=!p.value},B=()=>{k.value=!k.value},E=()=>{C.value=!C.value},T=()=>{c.value=!c.value,c.value&&J()},d=v(null),J=async()=>{try{const a=await ue(y.phone);d.value=a}catch(a){console.error("获取订单失败:",a)}},M=()=>{u.value.newPassword="",u.value.verificationCode="",m.value=0,_&&(clearInterval(_),_=null)};return(a,e)=>{const F=r("el-badge"),j=r("el-input"),z=r("el-form-item"),H=r("el-col"),$=r("el-button"),X=r("el-row"),Y=r("el-form"),Z=r("el-dialog"),w=r("el-descriptions-item"),ee=r("el-descriptions"),S=r("router-link");return g(),b(ae,null,[o(ne),l("div",ve,[l("aside",pe,[e[12]||(e[12]=l("div",{class:"sidebar-header"},[l("h3",null,"用户中心")],-1)),l("ul",fe,[l("li",{onClick:e[0]||(e[0]=n=>h("userInfo")),class:f({active:p.value})},"用户信息",2),l("li",{onClick:e[1]||(e[1]=n=>h("orderDetails")),class:f({active:c.value})},[e[10]||(e[10]=s("订单详情")),o(F,{"is-dot":q.value,hidden:!q.value},null,8,["is-dot","hidden"])],2),x.value?(g(),b("li",{key:0,onClick:e[2]||(e[2]=n=>h("database")),class:f({active:k.value})},"数据库",2)):N("",!0),x.value?(g(),b("li",{key:1,onClick:e[3]||(e[3]=n=>h("orderProcess")),class:f({active:C.value})},[e[11]||(e[11]=s("用户订单处理")),o(F,{value:L.value},null,8,["value"])],2)):N("",!0)])]),l("main",ce,[l("div",me,[l("h3",null,[e[13]||(e[13]=s("用户信息 ")),l("span",{class:f(["arrow",{"arrow-down":p.value,"arrow-right":!p.value}]),onClick:e[4]||(e[4]=n=>p.value=!p.value),title:"点击展开/收起",style:{cursor:"pointer","margin-left":"10px"}},null,2)]),O(l("div",_e,[l("div",we,[e[18]||(e[18]=l("div",{class:"profile-avatar"},[l("img",{src:"https://via.placeholder.com/80",alt:"Avatar"}),l("button",null," 上传头像 ")],-1)),l("div",ge,[l("div",null,[e[14]||(e[14]=l("p",{style:{"font-weight":"bold"}},"电话号:",-1)),l("p",be,i(K(y).phone),1)]),l("div",null,[e[15]||(e[15]=l("p",{style:{"font-weight":"bold"}},"用户字符串:",-1)),l("p",ye,i(K(y).randomString),1)]),l("div",null,[e[16]||(e[16]=l("p",{style:{"font-weight":"bold"}},"管理员/客户:",-1)),l("p",ke,i(x.value?"管理员":"客户"),1)]),e[17]||(e[17]=l("div",null,[l("p",{style:{"font-weight":"bold"}},"密码："),l("p",{style:{"font-style":"italic"}},"*************")],-1))]),l("div",Ce,[l("p",null,[l("button",{onClick:e[5]||(e[5]=n=>P.value=!0)},"更改用户密码")])])]),o(Z,{title:"更改用户密码",modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=n=>P.value=n),width:"400px",onClose:M},{default:t(()=>[o(Y,{model:u.value,rules:Q,ref_key:"passwordForm",ref:A},{default:t(()=>[o(z,{label:"新密码",prop:"newPassword"},{default:t(()=>[o(j,{type:"password",modelValue:u.value.newPassword,"onUpdate:modelValue":e[6]||(e[6]=n=>u.value.newPassword=n),placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(z,{label:"验证码",prop:"verificationCode"},{default:t(()=>[o(X,{gutter:10},{default:t(()=>[o(H,{span:16},{default:t(()=>[o(j,{modelValue:u.value.verificationCode,"onUpdate:modelValue":e[7]||(e[7]=n=>u.value.verificationCode=n),placeholder:"请输入验证码"},null,8,["modelValue"])]),_:1}),o(H,{span:8},{default:t(()=>[o($,{disabled:m.value>0,onClick:R,block:""},{default:t(()=>[s(i(m.value>0?`${m.value}s`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l("span",Ve,[o($,{onClick:e[8]||(e[8]=n=>P.value=!1)},{default:t(()=>e[19]||(e[19]=[s("取 消")])),_:1}),o($,{onClick:W},{default:t(()=>e[20]||(e[20]=[s("确 定")])),_:1})])]),_:1},8,["modelValue"])],512),[[D,p.value]])]),l("div",xe,[l("h3",null,[e[21]||(e[21]=s(" 订单详情 ")),l("span",{class:f(["arrow",{"arrow-down":c.value,"arrow-right":!c.value}]),onClick:T,title:"点击展开/收起",style:{cursor:"pointer","margin-left":"10px"}},null,2)]),O(l("div",Pe,[d.value?(g(),b("div",Ie,[o(ee,{column:2,border:""},{default:t(()=>[o(w,{label:"创建时间"},{default:t(()=>[s(i(d.value.createTime),1)]),_:1}),o(w,{label:"邮箱"},{default:t(()=>[s(i(d.value.email),1)]),_:1}),o(w,{label:"姓/姓名"},{default:t(()=>[s(i(d.value.fullName),1)]),_:1}),o(w,{label:"需求"},{default:t(()=>[s(i(d.value.product),1)]),_:1}),o(w,{label:"项目名称"},{default:t(()=>[s(i(d.value.projectName),1)]),_:1}),o(w,{label:"状态"},{default:t(()=>[s(i(d.value.status),1)]),_:1}),o(w,{label:"项目详情"},{default:t(()=>[s(i(d.value.issue),1)]),_:1})]),_:1})])):(g(),b("div",he,[e[23]||(e[23]=l("p",null,"无订单信息",-1)),o(S,{to:"/request"},{default:t(()=>e[22]||(e[22]=[l("button",null,"前往填写需求表单",-1)])),_:1})]))],512),[[D,c.value]])]),x.value?(g(),b("div",Ne,[l("h3",null,[e[24]||(e[24]=s(" 数据库管理 ")),l("span",{class:f(["arrow",{"arrow-down":k.value,"arrow-right":!k.value}]),onClick:B,title:"点击展开/收起",style:{cursor:"pointer"}},null,2)]),O(l("div",Oe,[o(S,{to:"/dataset"},{default:t(()=>e[25]||(e[25]=[l("button",null,"进入地图数据库",-1)])),_:1})],512),[[D,k.value]])])):N("",!0),x.value?(g(),b("div",De,[l("h3",null,[e[26]||(e[26]=s(" 用户订单处理 ")),l("span",{class:f(["arrow",{"arrow-down":C.value,"arrow-right":!C.value}]),onClick:E,title:"点击展开/收起",style:{cursor:"pointer"}},null,2)]),O(l("div",Fe,[o(S,{to:"/orderDataset"},{default:t(()=>e[27]||(e[27]=[l("button",null,"进入订单数据库",-1)])),_:1})],512),[[D,C.value]])])):N("",!0)])])],64)}}});const qe=de($e,[["__scopeId","data-v-ee957911"]]);export{qe as default};
