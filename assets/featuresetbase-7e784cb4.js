import{m as Ie}from"./TimeOnly-430d9cda.js";import{a as E,v as De,w as X,B as x,N as v,b as c,r as m,G as P,m as N,y as Te,A as ue,X as de,W as ce,P as L,F as k,U as A,H as j,I as be,Q as M,_ as Ee,g as O,D as Ne,K as Ae,S as _,T as Y,V as xe,$ as q}from"./arcadeUtils-17432649.js";import{q as Se,G as me,d as Le,c as B,e as Ce,a as ve,b as Pe,T as ee,E as Ze,N as Ue,O as $e,B as R,f as Re,k as K,L as C,I as te}from"./featureSetUtils-824ae09a.js";import{t as Me}from"./ImmutableArray-d5cad66d.js";import{l as ke}from"./portalUtils-00bd6b5f.js";import{u as Oe,D as pe}from"./SpatialFilter-3b23d3e6.js";import{aU as ye,eA as ze,bg as G}from"./index-c6cfe049.js";import{O as b}from"./WhereClause-7f089e1b.js";import ne from"./FeatureLayer-8ad4904b.js";import"./UnknownTimeZone-b1c85c08.js";import"./number-4419c5af.js";import"./featureConversionUtils-830d3ed6.js";import"./OptimizedFeature-059c854c.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./FieldsIndex-815a254a.js";import"./MD5-715f37cd.js";import"./infoFor3D-24efd44a.js";import"./executeQueryJSON-98e87b3a.js";import"./query-6eccb0bd.js";import"./pbfQueryUtils-90563513.js";import"./pbf-459508d1.js";import"./queryZScale-679c8a27.js";import"./FeatureSet-402c1fc5.js";import"./executeQueryPBF-5326e45a.js";import"./AttachmentInfo-e88c7f2e.js";import"./RelationshipQuery-21a3a6e4.js";import"./executeForIds-6228f84d.js";import"./TopFeaturesQuery-4768fc42.js";import"./FeatureType-b94bd31c.js";import"./FeatureTemplate-1f82a77c.js";import"./geometryEngineAsync-04821dd4.js";import"./UniqueValueRenderer-2d905f9d.js";import"./ColorStop-3bd1e817.js";import"./diffUtils-a81eba90.js";import"./colorRamps-2725f079.js";import"./sizeVariableUtils-d4870b0d.js";import"./visualVariableUtils-57487c58.js";import"./lengthUtils-806c8c03.js";import"./jsonUtils-17af088a.js";import"./defaults-458d9190.js";import"./defaultsJSON-59981e75.js";import"./styleUtils-12717ade.js";import"./jsonUtils-0cfa0239.js";import"./LRUCache-be26918b.js";import"./Version-d58b3305.js";import"./OverrideHelper-78bed9ed.js";import"./colorUtils-60e0b64a.js";import"./vec42-614f5847.js";import"./vec4f64-430e4feb.js";import"./utils-2af5df8d.js";import"./quantizationUtils-07a0781e.js";import"./heatmapUtils-dc73c34c.js";import"./MultiOriginJSONSupport-7cf2254f.js";import"./commonProperties-b537568a.js";import"./ElevationInfo-58ee6e4f.js";import"./FeatureLayerBase-c91a0e0e.js";import"./featureLayerUtils-6e37b4eb.js";import"./LayerFloorInfo-b8c105f0.js";import"./Relationship-96215281.js";import"./serviceCapabilitiesUtils-27401658.js";import"./editsZScale-d0d79ab9.js";import"./APIKeyMixin-99f87d3a.js";import"./ArcGISService-866655aa.js";import"./BlendLayer-3864a0e6.js";import"./jsonUtils-a377b268.js";import"./parser-7740a44f.js";import"./CustomParametersMixin-d7ae0b0b.js";import"./EditBusLayer-1e67be81.js";import"./FeatureEffectLayer-ad153b3a.js";import"./FeatureEffect-0fa11288.js";import"./FeatureReductionLayer-d2b80ebd.js";import"./FeatureReductionSelection-4696fdf2.js";import"./labelingInfo-754601fb.js";import"./labelUtils-e96173b2.js";import"./OperationalLayer-d666f103.js";import"./OrderedLayer-4b37be9f.js";import"./OrderByInfo-3aa9a06f.js";import"./PortalLayer-089ac58c.js";import"./portalItemUtils-bca17985.js";import"./RefreshableLayer-768cbb26.js";import"./ScaleRangeLayer-2709e17c.js";import"./TemporalLayer-58903be1.js";import"./TimeInfo-3ab6fbf6.js";import"./fieldProperties-abc74b98.js";import"./versionUtils-20464c3d.js";import"./styleUtils-4d80df86.js";import"./popupUtils-c2bd8f97.js";import"./interfaces-f1f22245.js";function He(i){if(i.length===1){if(A(i[0]))return q("distinct",i[0],-1);if(M(i[0]))return q("distinct",i[0].toArray(),-1)}return q("distinct",i,-1)}async function ie(i,t,a){const y=i.getVariables();if(y.length>0){const I=[];for(let n=0;n<y.length;n++){const o={name:y[n]};I.push(await t.evaluateIdentifier(a,o))}const e={};for(let n=0;n<y.length;n++)e[y[n]]=I[n];return i.parameters=e,i}return i}function d(i,t,a=null){for(const y in i)if(y.toLowerCase()===t.toLowerCase())return i[y];return a}function we(i){if(i===null)return null;const t={type:d(i,"type",""),name:d(i,"name","")};if(t.type==="range")t.range=d(i,"range",[]);else{t.codedValues=[];for(const a of d(i,"codedValues",[]))t.codedValues.push({name:d(a,"name",""),code:d(a,"code",null)})}return t}function ae(i){if(i===null)return null;const t={},a=d(i,"wkt");a!==null&&(t.wkt=a);const y=d(i,"wkid");return y!==null&&(t.wkid=y),t}function he(i){if(i===null)return null;const t={hasZ:d(i,"hasz",!1),hasM:d(i,"hasm",!1)},a=d(i,"spatialreference");a!=null&&(t.spatialReference=ae(a));const y=d(i,"x",null);if(y!==null)return t.x=y,t.y=d(i,"y",null),t.hasZ&&(t.z=d(i,"z",null)),t.hasM&&(t.m=d(i,"m",null)),t;const I=d(i,"rings",null);if(I!==null)return t.rings=I,t;const e=d(i,"paths",null);if(e!==null)return t.paths=e,t;const n=d(i,"points",null);if(n!==null)return t.points=n,t;for(const o of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const f=d(i,o,null);f!==null&&(t[o]=f)}return t}function We(i,t){for(const a of t)if(a===i)return!0;return!1}function Ge(i){return!!i.layerDefinition&&!!i.featureSet&&We(i.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(i.layerDefinition.fields)!==!1&&A(i.featureSet.features)!==!1}function z(i){return(i==null?void 0:i.toLowerCase())==="utc"?"UTC":(i==null?void 0:i.toLowerCase())==="unknown"?"Unknown":i}function Nn(i){i.mode==="async"&&(i.functions.timezone=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{var f,p;if(E(e,1,2,t,a),De(e[0])||X(e[0]))return"Unknown";if(x(e[0])){if(await e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?z("unknown"):z(e[0].dateFieldsTimeZone);if(!(e[1]instanceof v)||e[1].hasField("type")===!1)throw new c(t,m.InvalidParameter,a);const l=e[1].field("type");if(P(l)===!1)throw new c(t,m.InvalidParameter,a);switch(N(l).toLowerCase()){case"preferredtimezone":return z(e[0].preferredTimeZone);case"editfieldsinfo":return z(((f=e[0].editFieldsInfo)==null?void 0:f.timeZone)??null);case"timeinfo":return z(((p=e[0].timeInfo)==null?void 0:p.timeZone)??null);case"field":if(e[1].hasField("fieldname")&&P(e[1].field("fieldname")))return z(e[0].fieldTimeZone(N(e[1].field("fieldname"))))}throw new c(t,m.InvalidParameter,a)}const n=Te(e[0],ue(t));if(n===null)return null;const o=n.timeZone;return o==="system"?Ie.systemTimeZoneCanonicalName:o.toLowerCase()==="utc"?"UTC":o.toLowerCase()==="unknown"?"Unknown":o})},i.functions.sqltimestamp=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{E(e,1,3,t,a);const n=e[0];if(de(n)){if(e.length===1)return n.toSQLWithKeyword();if(e.length===2)return n.changeTimeZone(N(e[1])).toSQLWithKeyword();throw new c(t,m.InvalidParameter,a)}if(X(n))return n.toSQLWithKeyword();if(x(n)){if(e.length!==3)throw new c(t,m.InvalidParameter,a);await n.load();const o=N(e[1]);if(X(e[2]))return e[2].toSQLWithKeyword();if(de(e[2])===!1)throw new c(t,m.InvalidParameter,a);const f=n.fieldTimeZone(o);return f===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(f).toSQLWithKeyword()}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"sqltimestamp",min:2,max:4}),i.functions.featuresetbyid=function(t,a){return i.standardFunctionAsync(t,a,(y,I,e)=>{if(E(e,2,4,t,a),ce(e[0])){const n=N(e[1]);let o=L(e[2],null);const f=k(L(e[3],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new c(t,m.InvalidParameter,a);return e[0].featureSetById(n,f,o)}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"featuresetbyid",min:2,max:4}),i.functions.getfeatureset=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,1,2,t,a),j(e[0])){let n=L(e[1],"datasource");return n===null&&(n="datasource"),n=N(n).toLowerCase(),Se(e[0].fullSchema(),n,t.lrucache,t.interceptor,t.spatialReference??null)}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"getfeatureset",min:1,max:2}),i.functions.featuresetbyportalitem=function(t,a){return i.standardFunctionAsync(t,a,(y,I,e)=>{var l,r;if(E(e,2,5,t,a),e[0]===null)throw new c(t,m.PortalRequired,a);if(e[0]instanceof be){const s=N(e[1]),u=N(e[2]);let w=L(e[3],null);const D=k(L(e[4],!0));if(w===null&&(w=["*"]),A(w)===!1)throw new c(t,m.InvalidParameter,a);let h;return h=(l=t.services)!=null&&l.portal?t.services.portal:ye.getDefault(),h=ke(e[0],h),me(s,u,t.spatialReference??null,w,D,h,t.lrucache,t.interceptor)}if(P(e[0])===!1)throw new c(t,m.PortalRequired,a);const n=N(e[0]),o=N(e[1]);let f=L(e[2],null);const p=k(L(e[3],!0));if(f===null&&(f=["*"]),A(f)===!1)throw new c(t,m.InvalidParameter,a);return me(n,o,t.spatialReference??null,f,p,((r=t.services)==null?void 0:r.portal)??ye.getDefault(),t.lrucache,t.interceptor)})},i.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),i.functions.featuresetbyname=function(t,a){return i.standardFunctionAsync(t,a,(y,I,e)=>{if(E(e,2,4,t,a),ce(e[0])){const n=N(e[1]);let o=L(e[2],null);const f=k(L(e[3],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new c(t,m.InvalidParameter,a);return e[0].featureSetByName(n,f,o)}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"featuresetbyname",min:2,max:4}),i.functions.featureset=function(t,a){return i.standardFunction(t,a,(y,I,e)=>{E(e,1,1,t,a);const n={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(P(e[0])){const o=JSON.parse(e[0]);o.layerDefinition!==void 0?(n.layerDefinition=o.layerDefinition,n.featureSet=o.featureSet,o.layerDefinition.spatialReference&&(n.layerDefinition.spatialReference=o.layerDefinition.spatialReference)):(n.featureSet.features=o.features,n.featureSet.geometryType=o.geometryType,n.layerDefinition.geometryType=n.featureSet.geometryType,n.layerDefinition.objectIdField=o.objectIdFieldName??"",n.layerDefinition.typeIdField=o.typeIdFieldName,n.layerDefinition.globalIdField=o.globalIdFieldName,n.layerDefinition.fields=o.fields,o.spatialReference&&(n.layerDefinition.spatialReference=o.spatialReference))}else{if(!(e[0]instanceof v))throw new c(t,m.InvalidParameter,a);{const o=JSON.parse(e[0].castToText(!0)),f=d(o,"layerdefinition");if(f!==null){n.layerDefinition.geometryType=d(f,"geometrytype",""),n.featureSet.geometryType=n.layerDefinition.geometryType,n.layerDefinition.globalIdField=d(f,"globalidfield",""),n.layerDefinition.objectIdField=d(f,"objectidfield",""),n.layerDefinition.typeIdField=d(f,"typeidfield",""),n.layerDefinition.hasZ=d(f,"hasz",!1)===!0,n.layerDefinition.hasM=d(f,"hasm",!1)===!0;const p=d(f,"spatialreference");p&&(n.layerDefinition.spatialReference=ae(p));const l=[];for(const s of d(f,"fields",[])){const u={name:d(s,"name",""),alias:d(s,"alias",""),type:d(s,"type",""),nullable:d(s,"nullable",!0),editable:d(s,"editable",!0),length:d(s,"length",null),domain:we(d(s,"domain"))};l.push(u)}n.layerDefinition.fields=l;const r=d(o,"featureset");if(r){const s={};for(const u of l)s[u.name.toLowerCase()]=u.name;for(const u of d(r,"features",[])){const w={},D=d(u,"attributes",{});for(const h in D)w[s[h.toLowerCase()]]=D[h];n.featureSet.features.push({attributes:w,geometry:he(d(u,"geometry"))})}}}else{n.layerDefinition.hasZ=d(o,"hasz",!1)===!0,n.layerDefinition.hasM=d(o,"hasm",!1)===!0,n.layerDefinition.geometryType=d(o,"geometrytype",""),n.featureSet.geometryType=n.layerDefinition.geometryType,n.layerDefinition.objectIdField=d(o,"objectidfieldname",""),n.layerDefinition.typeIdField=d(o,"typeidfieldname","");const p=d(o,"spatialreference");p&&(n.layerDefinition.spatialReference=ae(p));const l=[],r=d(o,"fields",null);if(!A(r))throw new c(t,m.InvalidParameter,a);for(const w of r){const D={name:d(w,"name",""),alias:d(w,"alias",""),type:d(w,"type",""),nullable:d(w,"nullable",!0),editable:d(w,"editable",!0),length:d(w,"length",null),domain:we(d(w,"domain"))};l.push(D)}n.layerDefinition.fields=l;const s={};for(const w of l)s[w.name.toLowerCase()]=w.name;let u=d(o,"features",null);if(A(u))for(const w of u){const D={},h=d(w,"attributes",{});for(const T in h)D[s[T.toLowerCase()]]=h[T];n.featureSet.features.push({attributes:D,geometry:he(d(w,"geometry",null))})}else u=null,n.featureSet.features=u}}}if(Ge(n)===!1)throw new c(t,m.InvalidParameter,a);return n.layerDefinition.geometryType||(n.layerDefinition.geometryType="esriGeometryNull"),Le.create(n,t.spatialReference)})},i.signatures.push({name:"featureset",min:1,max:1}),i.functions.filter=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,2,2,t,a),A(e[0])||M(e[0])){const n=[];let o,f=e[0];if(f instanceof Me&&(f=f.toArray()),!Ee(e[1]))throw new c(t,m.InvalidParameter,a);o=e[1].createFunction(t);for(const p of f){const l=o(p);ze(l)?await l===!0&&n.push(p):l===!0&&n.push(p)}return n}if(x(e[0])){const n=await e[0].load(),o=b.create(e[1],n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),f=o.getVariables();if(f.length>0){const p=[];for(let r=0;r<f.length;r++){const s={name:f[r]};p.push(await i.evaluateIdentifier(t,s))}const l={};for(let r=0;r<f.length;r++)l[f[r]]=p[r];return o.parameters=l,new B({parentfeatureset:e[0],whereclause:o})}return new B({parentfeatureset:e[0],whereclause:o})}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"filter",min:2,max:2}),i.functions.orderby=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,2,2,t,a),x(e[0])){const n=new Ce(e[1]);return new ve({parentfeatureset:e[0],orderbyclause:n})}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"orderby",min:2,max:2}),i.functions.top=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,2,2,t,a),x(e[0]))return new Pe({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return O(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,O(e[1]));if(M(e[0]))return O(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,O(e[1]));throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"top",min:2,max:2}),i.functions.first=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,1,1,t,a),x(e[0])){const n=await e[0].first(y.abortSignal);if(n!==null){const o=Ne.createFromGraphicLikeObject(n.geometry,n.attributes,e[0],t.timeZone);return o._underlyingGraphic=n,o}return n}return A(e[0])?e[0].length===0?null:e[0][0]:M(e[0])?e[0].length()===0?null:e[0].get(0):null})},i.signatures.push({name:"first",min:1,max:1}),i.functions.attachments=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{E(e,1,2,t,a);const n={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof v){if(e[1].hasField("minsize")&&(n.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(n.returnMetadata=k(e[1].field("metadata"))),e[1].hasField("maxsize")&&(n.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){const o=Ae(e[1].field("types"),!1);o.length>0&&(n.types=o)}}else if(e[1]!==null)throw new c(t,m.InvalidParameter,a)}if(j(e[0])){let o=e[0]._layer;return o instanceof ne&&(o=ee(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),o===null?[]:x(o)===!1?[]:(await o.load(),o.queryAttachments(e[0].field(o.objectIdField),n.minsize,n.maxsize,n.types,n.returnMetadata))}if(e[0]===null)return[];throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"attachments",min:1,max:2}),i.functions.featuresetbyrelationshipname=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{E(e,2,4,t,a);const n=e[0],o=N(e[1]);let f=L(e[2],null);const p=k(L(e[3],!0));if(f===null&&(f=["*"]),A(f)===!1)throw new c(t,m.InvalidParameter,a);if(e[0]===null)return null;if(!j(e[0]))throw new c(t,m.InvalidParameter,a);let l=n._layer;if(l instanceof ne&&(l=ee(l,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),l===null||x(l)===!1)return null;l=await l.load();const r=l.relationshipMetaData().filter(h=>h.name===o);if(r.length===0)return null;if(r[0].relationshipTableId!==void 0&&r[0].relationshipTableId!==null&&r[0].relationshipTableId>-1)return Ze(l,r[0],n.field(l.objectIdField),l.spatialReference,f,p,t.lrucache,t.interceptor);let s=l.serviceUrl();if(!s)return null;s=s.charAt(s.length-1)==="/"?s+r[0].relatedTableId.toString():s+"/"+r[0].relatedTableId.toString();const u=await Ue(s,l.spatialReference,f,p,t.lrucache,t.interceptor);await u.load();let w=u.relationshipMetaData();if(w=w.filter(h=>h.id===r[0].id),n.hasField(r[0].keyField)===!1||n.field(r[0].keyField)===null){const h=await l.getFeatureByObjectId(n.field(l.objectIdField),[r[0].keyField]);if(h){const T=b.create(w[0].keyField+"= @id",u.getFieldsIndex(),u.dateFieldsTimeZoneDefaultUTC);return T.parameters={id:h.attributes[r[0].keyField]},u.filter(T)}return new Oe({parentfeatureset:u})}const D=b.create(w[0].keyField+"= @id",u.getFieldsIndex(),u.dateFieldsTimeZoneDefaultUTC);return D.parameters={id:n.field(r[0].keyField)},u.filter(D)})},i.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),i.functions.featuresetbyassociation=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{E(e,2,3,t,a);const n=e[0],o=N(L(e[1],"")).toLowerCase(),f=P(e[2])?N(e[2]):null;if(e[0]===null)return null;if(!j(e[0]))throw new c(t,m.InvalidParameter,a);let p=n._layer;if(p instanceof ne&&(p=ee(p,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),p===null||x(p)===!1)return null;await p.load();const l=p.serviceUrl(),r=await $e(l,t.spatialReference);let s=null,u=null,w=!1;if(f!==null&&f!==""&&f!==void 0){for(const F of r.terminals)F.terminalName===f&&(u=F.terminalId);u===null&&(w=!0)}const D=r.associations.getFieldsIndex(),h=D.get("TOGLOBALID").name,T=D.get("FROMGLOBALID").name,V=D.get("TOTERMINALID").name,Q=D.get("FROMTERMINALID").name,H=D.get("FROMNETWORKSOURCEID").name,W=D.get("TONETWORKSOURCEID").name,$=D.get("ASSOCIATIONTYPE").name,ge=D.get("ISCONTENTVISIBLE").name,Fe=D.get("OBJECTID").name;for(const F of p.fields)if(F.type==="global-id"){s=n.field(F.name);break}let Z=null,re=new R(new G({name:"percentalong",alias:"percentalong",type:"double"}),b.create("0",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),oe=new R(new G({name:"side",alias:"side",type:"string"}),b.create("''",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));const S="globalid",se="globalId",le={};for(const F in r.lkp)le[F]=r.lkp[F].sourceId;const U=new Re(new G({name:"classname",alias:"classname",type:"string"}),null,le);let g="";switch(o){case"midspan":{g=`((${h}='${s}') OR ( ${T}='${s}')) AND (${$} IN (5))`,U.codefield=b.create(`CASE WHEN (${h}='${s}') THEN ${H} ELSE ${W} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const F=Y(C.findField(r.associations.fields,T));F.name=S,F.alias=S,Z=new R(F,b.create(`CASE WHEN (${T}='${s}') THEN ${h} ELSE ${T} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),re=r.unVersion>=4?new te(C.findField(r.associations.fields,D.get("PERCENTALONG").name)):new R(new G({name:"percentalong",alias:"percentalong",type:"double"}),b.create("0",r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{g=`((${h}='${s}') OR ( ${T}='${s}')) AND (${$} IN (4,6))`,U.codefield=b.create(`CASE WHEN (${h}='${s}') THEN ${H} ELSE ${W} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const F=Y(C.findField(r.associations.fields,T));F.name=S,F.alias=S,Z=new R(F,b.create(`CASE WHEN (${T}='${s}') THEN ${h} ELSE ${T} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC)),oe=new R(new G({name:"side",alias:"side",type:"string"}),b.create(`CASE WHEN (${$}=4) THEN 'from' ELSE 'to' END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let F=`${h}='@T'`,fe=`${T}='@T'`;u!==null&&(F+=` AND ${V}=@A`,fe+=` AND ${Q}=@A`),g="(("+F+") OR ("+fe+"))",g=_(g,"@T",s??""),F=_(F,"@T",s??""),u!==null&&(F=_(F,"@A",u.toString()),g=_(g,"@A",u.toString())),U.codefield=b.create("CASE WHEN "+F+` THEN ${H} ELSE ${W} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC);const J=Y(C.findField(r.associations.fields,T));J.name=S,J.alias=S,Z=new R(J,b.create("CASE WHEN "+F+` THEN ${T} ELSE ${h} END`,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":g=`${h}='${s}' AND ${$} = 2`,u!==null&&(g+=` AND ${V} = `+u.toString()),U.codefield=H,g="( "+g+" )",Z=new K(C.findField(r.associations.fields,T),S,S);break;case"content":g=`(${T}='${s}' AND ${$} = 2)`,u!==null&&(g+=` AND ${Q} = `+u.toString()),U.codefield=W,g="( "+g+" )",Z=new K(C.findField(r.associations.fields,h),S,S);break;case"structure":g=`(${h}='${s}' AND ${$} = 3)`,u!==null&&(g+=` AND ${V} = `+u.toString()),U.codefield=H,g="( "+g+" )",Z=new K(C.findField(r.associations.fields,T),S,se);break;case"attached":g=`(${T}='${s}' AND ${$} = 3)`,u!==null&&(g+=` AND ${Q} = `+u.toString()),U.codefield=W,g="( "+g+" )",Z=new K(C.findField(r.associations.fields,h),S,se);break;default:throw new c(t,m.InvalidParameter,a)}return w&&(g="1 <> 1"),new C({parentfeatureset:r.associations,adaptedFields:[new te(C.findField(r.associations.fields,Fe)),new te(C.findField(r.associations.fields,ge)),Z,oe,U,re],extraFilter:g?b.create(g,r.associations.getFieldsIndex(),r.associations.dateFieldsTimeZoneDefaultUTC):null})})},i.signatures.push({name:"featuresetbyassociation",min:2,max:6}),i.functions.groupby=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,3,3,t,a),!x(e[0]))throw new c(t,m.InvalidParameter,a);const n=await e[0].load(),o=[],f=[];let p=!1,l=[];if(P(e[1]))l.push(e[1]);else if(e[1]instanceof v)l.push(e[1]);else if(A(e[1]))l=e[1];else{if(!M(e[1]))throw new c(t,m.InvalidParameter,a);l=e[1].toArray()}for(const r of l)if(P(r)){const s=b.create(N(r),n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),u=pe(s)===!0?N(r):"%%%%FIELDNAME";o.push({name:u,expression:s}),u==="%%%%FIELDNAME"&&(p=!0)}else{if(!(r instanceof v))throw new c(t,m.InvalidParameter,a);{const s=r.hasField("name")?r.field("name"):"%%%%FIELDNAME",u=r.hasField("expression")?r.field("expression"):"";if(s==="%%%%FIELDNAME"&&(p=!0),!s)throw new c(t,m.InvalidParameter,a);o.push({name:s,expression:b.create(u||s,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(l=[],P(e[2]))l.push(e[2]);else if(A(e[2]))l=e[2];else if(M(e[2]))l=e[2].toArray();else{if(!(e[2]instanceof v))throw new c(t,m.InvalidParameter,a);l.push(e[2])}for(const r of l){if(!(r instanceof v))throw new c(t,m.InvalidParameter,a);{const s=r.hasField("name")?r.field("name"):"",u=r.hasField("statistic")?r.field("statistic"):"",w=r.hasField("expression")?r.field("expression"):"";if(!s||!u||!w)throw new c(t,m.InvalidParameter,a);f.push({name:s,statistic:u.toLowerCase(),expression:b.create(w,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(p){const r={};for(const u of n.fields)r[u.name.toLowerCase()]=1;for(const u of o)u.name!=="%%%%FIELDNAME"&&(r[u.name.toLowerCase()]=1);for(const u of f)u.name!=="%%%%FIELDNAME"&&(r[u.name.toLowerCase()]=1);let s=0;for(const u of o)if(u.name==="%%%%FIELDNAME"){for(;r["field_"+s.toString()]===1;)s++;r["field_"+s.toString()]=1,u.name="FIELD_"+s.toString()}}for(const r of o)await ie(r.expression,i,t);for(const r of f)await ie(r.expression,i,t);return e[0].groupby(o,f)})},i.signatures.push({name:"groupby",min:3,max:3}),i.functions.distinct=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(x(e[0])){E(e,2,2,t,a);const n=await e[0].load(),o=[];let f=[];if(P(e[1]))f.push(e[1]);else if(e[1]instanceof v)f.push(e[1]);else if(A(e[1]))f=e[1];else{if(!M(e[1]))throw new c(t,m.InvalidParameter,a);f=e[1].toArray()}let p=!1;for(const l of f)if(P(l)){const r=b.create(N(l),n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),s=pe(r)===!0?N(l):"%%%%FIELDNAME";o.push({name:s,expression:r}),s==="%%%%FIELDNAME"&&(p=!0)}else{if(!(l instanceof v))throw new c(t,m.InvalidParameter,a);{const r=l.hasField("name")?l.field("name"):"%%%%FIELDNAME",s=l.hasField("expression")?l.field("expression"):"";if(r==="%%%%FIELDNAME"&&(p=!0),!r)throw new c(t,m.InvalidParameter,a);o.push({name:r,expression:b.create(s||r,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC)})}}if(p){const l={};for(const s of n.fields)l[s.name.toLowerCase()]=1;for(const s of o)s.name!=="%%%%FIELDNAME"&&(l[s.name.toLowerCase()]=1);let r=0;for(const s of o)if(s.name==="%%%%FIELDNAME"){for(;l["field_"+r.toString()]===1;)r++;l["field_"+r.toString()]=1,s.name="FIELD_"+r.toString()}}for(const l of o)await ie(l.expression,i,t);return e[0].groupby(o,[])}return He(e)})},i.functions.getfeaturesetinfo=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,1,1,t,a),!x(e[0]))return null;const n=await e[0].getFeatureSetInfo();return n?v.convertObjectToArcadeDictionary({layerId:n.layerId,layerName:n.layerName,itemId:n.itemId,serviceLayerUrl:n.serviceLayerUrl,webMapLayerId:n.webMapLayerId??null,webMapLayerTitle:n.webMapLayerTitle??null,className:null,objectClassId:null},ue(t),!1,!1):null})},i.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),i.functions.filterbysubtypecode=function(t,a){return i.standardFunctionAsync(t,a,async(y,I,e)=>{if(E(e,2,2,t,a),x(e[0])){const n=await e[0].load(),o=e[1];if(!xe(o))throw new c(t,m.InvalidParameter,a);if(n.subtypeField){const p=b.create(`${n.subtypeField}= ${e[1]}`,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:p})}if(n.typeIdField===null||n.typeIdField==="")throw new c(t,m.FeatureSetDoesNotHaveSubtypes,a);const f=b.create(`${n.typeIdField}= ${e[1]}`,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:f})}throw new c(t,m.InvalidParameter,a)})},i.signatures.push({name:"filterbysubtypecode",min:2,max:2}))}export{Nn as registerFunctions};
